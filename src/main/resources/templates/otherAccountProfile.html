<!-- src/main/resources/templates/otherAccountProfile.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <title>プロフィール</title>
  <link rel="stylesheet" th:href="@{/css/reset.css}" />
  <link rel="stylesheet" th:href="@{/css/header.css}" />
  <link rel="stylesheet" th:href="@{/css/otherAccountPage.css}" />
  <link rel="stylesheet" th:href="@{/css/sidebar.css}" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
</head>

<body>
  <header th:replace="fragments/header :: header"></header>

  <div class="two-col">
    <!-- 左：メイン -->
    <main class="main">

      <!-- ▼ プロフィールヘッダー -->
      <section th:if="${profileUser != null}" class="profile-header">
        <div class="profile-row">
          <div class="profile-row-left">
            <!-- アイコン -->
            <th:block th:with="
              v=${profileUser.iconImage},
              has=${!#strings.isEmpty(v)},
              isAbsUser=${has} ? ${#strings.startsWith(v,'/user-icons/')} : false,
              isAbsImg=${has} ? ${#strings.startsWith(v,'/images/')} : false,
              iconPath=${!has ? '/images/icon1.png' : (isAbsUser || isAbsImg ? v : '/images/'+v)}
            ">
              <img th:src="${iconPath}" alt="icon" class="profile-icon" />
            </th:block>

            <!-- 名前/自己紹介 -->
            <div class="profile-meta">
              <div class="profile-name-wrapper">
                <p>ユーザー名</p>
                <div class="profile-name" th:text="${profileUser.name}">ユーザー名</div>
              </div>
              <div class="profile-bio-wrapper">
                <p>自己紹介</p>
                <div class="profile-bio" th:text="${profileUser.bio != null ? profileUser.bio : ''}">自己紹介</div>
              </div>
            </div>
          </div>

          <!-- フォロー/解除ボタン -->
          <div class="profile-actions" th:if="${session.userId != null and profileUser.id != session.userId}">
            <form th:if="${!isFollowing}" th:action="@{/follow}" method="post">
              <input type="hidden" name="targetId" th:value="${profileUser.id}" />
              <button type="submit" class="btn-follow">フォローする</button>
            </form>
            <form th:if="${isFollowing}" th:action="@{/unfollow}" method="post">
              <input type="hidden" name="targetId" th:value="${profileUser.id}" />
              <button type="submit" class="btn-unfollow">フォロー解除</button>
            </form>
          </div>
        </div>
      </section>

      <!-- ▼ 投稿一覧：topPage と同じ構造 -->
      <section>
        <div th:with="list=${profilePosts}">
          <div th:if="${list == null or #lists.isEmpty(list)}" class="empty">
            投稿がありません。
          </div>

          <div th:each="post : ${list}" class="post-card" th:if="${post != null}">
            <div class="post-container">

              <!-- 投稿ユーザーのアイコン -->
              <th:block th:with="
                pimg=${post.user != null} ? ${post.user.iconImage} : null,
                has=${!#strings.isEmpty(pimg)},
                isAbsUser=${has} ? ${#strings.startsWith(pimg,'/user-icons/')} : false,
                isAbsImg=${has} ? ${#strings.startsWith(pimg,'/images/')} : false,
                iconPath=${!has ? '/images/icon1.png' : (isAbsUser || isAbsImg ? pimg : '/images/'+pimg)}
              ">
                <a th:href="@{/users/{id}(id=${post.user.id})}">
                  <img th:src="${iconPath}" alt="アイコン" class="post-icon" />
                </a>
              </th:block>

              <div class="post-wrapper">
                <p class="post-user">
                  <a th:href="@{/users/{id}(id=${post.user.id})}"
                     th:text="${post.user.name}">ユーザー名</a>
                </p>
                <p class="post-content" th:text="${post.post}">投稿内容</p>
              </div>
            </div>

            <div class="post-right">
              <p class="post-time" th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">投稿日時</p>

              <!-- 自分の投稿だけ編集/削除 -->
              <div th:if="${post.user != null and post.user.id == session.userId}" class="post-actions">
                <button type="button" class="edit-btn"
                        th:attr="data-id=${post.id}, data-content=${post.post}"></button>
                <form th:action="@{/deletePost}" method="post" onsubmit="return confirm('本当に削除しますか？');">
                  <input type="hidden" name="postId" th:value="${post.id}" />
                  <button type="submit" class="trash-btn"></button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </section>

    </main>

    <!-- 右：サイドバー -->
    <aside th:replace="~{fragments/sidebar :: sidebar}"></aside>
  </div>

  <script th:src="@{/js/header.js}"></script>
  <script th:src="@{/js/postEdit.js}"></script>
</body>
</html>