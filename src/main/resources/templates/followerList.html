<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>フォロワーリスト</title>
  <link rel="stylesheet" th:href="@{/css/reset.css}" />
  <link rel="stylesheet" th:href="@{/css/header.css}" />
  <link rel="stylesheet" th:href="@{/css/followList.css}" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
</head>
<body>
  <!-- ヘッダー -->
  <header th:replace="~{fragments/header :: header}"></header>

  <div class="followList-container">
    <div class="followList-wrapper">
      <!-- ── 上部：フォロワーのアイコン帯 ── -->
      <section class="icon-strips">
        <div class="strip" th:if="${followers != null and !#lists.isEmpty(followers)}">
          <h2 class="strip-title">フォロワーリスト</h2>
          <ul class="icon-list">
            <li class="icon-item" th:each="u : ${followers}">
              <a th:href="@{/users/{id}(id=${u.id})}" class="icon-link" th:title="${u.name}">
                <img class="icon-img"
                     th:src="${!#strings.isEmpty(u.iconImage) ? 
                               (#strings.startsWith(u.iconImage,'/user-icons/') || #strings.startsWith(u.iconImage,'/images/')
                                 ? u.iconImage : '/images/' + u.iconImage)
                               : '/images/default.png'}"
                     alt="user icon" />
              </a>
            </li>
          </ul>
        </div>
      </section>

      <!-- ── タイムライン（フォロワーの全投稿） ── -->
      <section class="timeline" th:if="${posts != null and !#lists.isEmpty(posts)}">
        <ul class="post-list">
          <li class="post-item" th:each="p : ${posts}">
            <div class="post-main">
              <a class="post-link" th:href="@{/users/{id}(id=${p.user.id})}">
                <img class="post-icon
                     " th:src="${!#strings.isEmpty(p.user.iconImage) ? 
                               (#strings.startsWith(p.user.iconImage,'/user-icons/') || #strings.startsWith(p.user.iconImage,'/images/')
                                 ? p.user.iconImage : '/images/' + p.user.iconImage)
                               : '/images/default.png'}"
                     alt="icon" />
              </a>
              <div class="post-head">
                <a class="post-user" th:href="@{/users/{id}(id=${p.user.id})}"
                   th:text="${p.user.name}">ユーザー名</a>
                <div class="post-body" th:text="${p.content}">本文</div>
              </div>
            </div>
            <span class="post-time"
                  th:text="${#temporals.format(p.createdAt, 'yyyy/MM/dd HH:mm')}">日時</span>
          </li>
        </ul>
      </section>
    </div>

    <!-- 概要 -->
    <section class="follow-summary">
      <div class="follow-wrapper">
        <p class="user-name" th:text="${session.userName} + 'さんの'">ログインユーザーさんの</p>
        <div class="follow-count">
          <p>フォロー数　<span><span th:text="${followings != null ? followings.size() : 0}">0</span>人</span></p>
          <form th:action="@{/followList}" method="get">
            <button type="submit">フォローリスト</button>
          </form>
        </div>
        <div class="follow-count">
          <p>フォロワー数　<span><span th:text="${followers != null ? followers.size() : 0}">0</span>人</span></p>
          <form th:action="@{/followerList}" method="get">
            <button type="submit">フォロワーリスト</button>
          </form>
        </div>
      </div>

	  <a th:href="@{/userSearch}" class="btn user-search">ユーザー検索</a>
    </section>
  </div>

  <script th:src="@{/js/header.js}"></script>
</body>
</html>